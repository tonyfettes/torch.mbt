test "Tensor::correlate2d" {
  let image = @tensor.tensor(
    [
      [0.0, 1.0, 2.0, 3.0],
      [4.0, 5.0, 6.0, 7.0],
      [8.0, 9.0, 10.0, 11.0],
      [12.0, 13.0, 14.0, 15.0],
    ],
  )
  let kernel = @tensor.tensor(
    [[0.0, 1.0, -1.0], [1.0, -1.0, 0.0], [1.0, 1.0, 0.0]],
  )
  inspect!(@tensor.correlate2d(image, kernel), content="[[15, 17], [23, 25]]")
}

test "Tensor::correlate2d - random" {
  @distributions.seed(b"12345678223456783234567842345678")
  let image = @distributions.Uniform::new(-1.0, 1.0).sample([4, 4])
  @json.inspect!(
    image,
    content=[
      [
        -0.2955702543258667, -0.8177422285079956, -0.8997843861579895, -0.1545487642288208,
      ],
      [
        -0.552005410194397, -0.0948251485824585, 0.6609057188034058, 0.21990251541137695,
      ],
      [
        0.43133544921875, 0.9582411050796509, 0.7228865623474121, -0.5188244581222534,
      ],
      [
        0.2701148986816406, -0.21887880563735962, 0.943917989730835, -0.4507488012313843,
      ],
    ],
  )
  let kernel = @distributions.Uniform::new(-1.0, 1.0).sample([2, 2])
  @json.inspect!(
    kernel,
    content=[
      [-0.5474874973297119, 0.41745615005493164],
      [0.39493775367736816, 0.997472882270813],
    ],
  )
  @json.inspect!(
    @tensor.correlate2d(image, kernel),
    content=[
      [-0.49214377999305725, 0.6938686370849609, 0.9084668159484863],
      [1.388800859451294, 1.4273200035095215, -0.5020561218261719],
      [0.05222576856613159, 0.6322375535964966, -0.6891786456108093],
    ],
  )
}

test "Tensor::correlate2d - Padding" {
  let image = @tensor.tensor(
    [
      [0.0, 1.0, 2.0, 3.0],
      [4.0, 5.0, 6.0, 7.0],
      [8.0, 9.0, 10.0, 11.0],
      [12.0, 13.0, 14.0, 15.0],
    ],
  )
  let kernel = @tensor.tensor(
    [[0.0, 1.0, -1.0], [1.0, -1.0, 0.0], [1.0, 1.0, 0.0]],
  )
  @json.inspect!(
    @tensor.correlate2d(image, kernel, padding=(2, 2)),
    content=[
      [0, 0, 1, 3, 5, 3],
      [0, 4, 8, 10, 12, 10],
      [0, 3, 15, 17, 23, 18],
      [-4, 3, 23, 25, 35, 26],
      [-8, -13, -2, -2, 10, 15],
      [-12, -1, -1, -1, 15, 0],
    ],
  )
}
