test "Tensor::correlate2d" {
  let image = @tensor.tensor(
    [
      [0.0, 1.0, 2.0, 3.0],
      [4.0, 5.0, 6.0, 7.0],
      [8.0, 9.0, 10.0, 11.0],
      [12.0, 13.0, 14.0, 15.0],
    ],
  )
  let kernel = @tensor.tensor(
    [[0.0, 1.0, -1.0], [1.0, -1.0, 0.0], [1.0, 1.0, 0.0]],
  )
  inspect!(@tensor.correlate2d(image, kernel), content="[[15, 17], [23, 25]]")
}

test "Tensor::correlate2d - random" {
  @distributions.seed(b"12345678223456783234567842345678")
  let image = @distributions.Uniform::new(-1.0, 1.0).sample([4, 4])
  @json.inspect!(
    image,
    content=[
      [
        -0.2955702841281891, -0.8177422285079956, -0.8997843861579895, -0.154548779129982,
      ],
      [
        -0.5520054697990417, -0.09482517838478088, 0.660905659198761, 0.21990250051021576,
      ],
      [
        0.4313355088233948, 0.9582411050796509, 0.7228865623474121, -0.5188244581222534,
      ],
      [
        0.2701149582862854, -0.21887879073619843, 0.9439179301261902, -0.4507488012313843,
      ],
    ],
  )
  let kernel = @distributions.Uniform::new(-1.0, 1.0).sample([2, 2])
  @json.inspect!(
    kernel,
    content=[
      [-0.5474874377250671, 0.41745609045028687],
      [0.39493778347969055, 0.997472882270813],
    ],
  )
  @json.inspect!(
    @tensor.correlate2d(image, kernel),
    content=[
      [-0.49214380979537964, 0.6938685178756714, 0.9084666967391968],
      [1.388800859451294, 1.4273200035095215, -0.5020560026168823],
      [0.0522257536649704, 0.6322374939918518, -0.6891785860061646],
    ],
  )
}

test "Tensor::correlate2d - Padding" {
  let image = @tensor.tensor(
    [
      [0.0, 1.0, 2.0, 3.0],
      [4.0, 5.0, 6.0, 7.0],
      [8.0, 9.0, 10.0, 11.0],
      [12.0, 13.0, 14.0, 15.0],
    ],
  )
  let kernel = @tensor.tensor(
    [[0.0, 1.0, -1.0], [1.0, -1.0, 0.0], [1.0, 1.0, 0.0]],
  )
  @json.inspect!(
    @tensor.correlate2d(image, kernel, padding=(2, 2)),
    content=[
      [0, 0, 1, 3, 5, 3],
      [0, 4, 8, 10, 12, 10],
      [0, 3, 15, 17, 23, 18],
      [-4, 3, 23, 25, 35, 26],
      [-8, -13, -2, -2, 10, 15],
      [-12, -1, -1, -1, 15, 0],
    ],
  )
}
