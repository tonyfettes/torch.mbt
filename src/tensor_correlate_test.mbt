test "Tensor::correlate2d" {
  let image = @torch.tensor(
    [
      [0.0, 1.0, 2.0, 3.0],
      [4.0, 5.0, 6.0, 7.0],
      [8.0, 9.0, 10.0, 11.0],
      [12.0, 13.0, 14.0, 15.0],
    ],
  )
  let kernel = @torch.tensor(
    [[0.0, 1.0, -1.0], [1.0, -1.0, 0.0], [1.0, 1.0, 0.0]],
  )
  inspect!(@torch.correlate2d(image, kernel), content="[[15, 17], [23, 25]]")
}

test "Tensor::correlate2d - random" {
  let image = @torch.Uniform::new(-1.0, 1.0).sample([4, 4])
  @json.inspect!(
    image,
    content=[
      [
        0.2319395440585279, -0.9572423457468497, -0.6499392928503491, -0.9692349476337747,
      ],
      [
        -0.336211990156319, -0.4338535669388379, -0.823622634469118, 0.6791392055258318,
      ],
      [
        0.6082472705301512, 0.33284866666437063, 0.05109986707794412, 0.7491360116621428,
      ],
      [
        -0.6769163155284783, -0.018489557848924587, 0.36148698168690196, -0.6127451963999322,
      ],
    ],
  )
  let kernel = @torch.Uniform::new(-1.0, 1.0).sample([2, 2])
  @json.inspect!(
    kernel,
    content=[
      [-0.268502714837354, -0.19072854174579712],
      [0.3077051226681604, -0.34001032471345205],
    ],
  )
  @json.inspect!(
    @torch.correlate2d(image, kernel),
    content=[
      [0.16435757994317718, 0.5275253764912075, -0.12497601278702467],
      [0.2470109080293602, 0.358623961993982, -0.14737660466812935],
      [-0.428803761582433, -0.22771561144958996, 0.16296901712562123],
    ],
  )
}
