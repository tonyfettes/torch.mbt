test "Tensor::correlate2d" {
  let image = @torch.tensor(
    [
      [0.0, 1.0, 2.0, 3.0],
      [4.0, 5.0, 6.0, 7.0],
      [8.0, 9.0, 10.0, 11.0],
      [12.0, 13.0, 14.0, 15.0],
    ],
  )
  let kernel = @torch.tensor(
    [[0.0, 1.0, -1.0], [1.0, -1.0, 0.0], [1.0, 1.0, 0.0]],
  )
  inspect!(@torch.correlate2d(image, kernel), content="[[15, 17], [23, 25]]")
}

test "Tensor::correlate2d - random" {
  @torch.seed(b"12345678223456783234567842345678")
  let image = @torch.Uniform::new(-1.0, 1.0).sample([4, 4])
  @json.inspect!(
    image,
    content=[
      [
        -0.29557028390369, -0.8177422144361883, -0.8997844018869048, -0.1545487762608706,
      ],
      [
        -0.5520054503667071, -0.09482517741472507, 0.6609056774831252, 0.21990249887250046,
      ],
      [
        0.4313355035432884, 0.9582411244732583, 0.7228865545307872, -0.5188244284458443,
      ],
      [
        0.2701149512079253, -0.21887879807607646, 0.9439179395000068, -0.4507487893925779,
      ],
    ],
  )
  let kernel = @torch.Uniform::new(-1.0, 1.0).sample([2, 2])
  @json.inspect!(
    kernel,
    content=[
      [-0.5474874554624833, 0.4174561037672295],
      [0.3949377908814846, 0.9974728937157387],
    ],
  )
  @json.inspect!(
    @torch.correlate2d(image, kernel),
    content=[
      [-0.49214381331510293, 0.6938685660678281, 0.908466752805929],
      [1.3888009485240067, 1.4273200803835957, -0.5020560123459269],
      [0.05222576303074239, 0.6322374591230756, -0.6891785782611096],
    ],
  )
}

test "Tensor::correlate2d - Padding" {
  let image = @torch.tensor(
    [
      [0.0, 1.0, 2.0, 3.0],
      [4.0, 5.0, 6.0, 7.0],
      [8.0, 9.0, 10.0, 11.0],
      [12.0, 13.0, 14.0, 15.0],
    ],
  )
  let kernel = @torch.tensor(
    [[0.0, 1.0, -1.0], [1.0, -1.0, 0.0], [1.0, 1.0, 0.0]],
  )
  @json.inspect!(
    @torch.correlate2d(image, kernel, padding=(2, 2)),
    content=[
      [0, 0, 1, 3, 5, 3],
      [0, 4, 8, 10, 12, 10],
      [0, 3, 15, 17, 23, 18],
      [-4, 3, 23, 25, 35, 26],
      [-8, -13, -2, -2, 10, 15],
      [-12, -1, -1, -1, 15, 0],
    ],
  )
}
