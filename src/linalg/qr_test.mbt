test "qr" {
  let a = @tensor.tensor([[12.0, -51, 4], [6, 167, -68], [-4, 24, -41]])
  let (q, r) = @linalg.qr(a)
  @json.inspect!(q, content=[
    [0.8571428656578064, -0.3942857086658478, -0.331428587436676],
    [0.4285714328289032, 0.9028571248054504, 0.03428562730550766],
    [-0.2857142984867096, 0.17142857611179352, -0.9428571462631226],
  ])
  @json.inspect!(r, content=[
    [14, 20.999996185302734, -13.999999046325684],
    [0, 175, -70],
    [0, 0, 35.00000762939453],
  ])
  @json.inspect!(q.matmul(r), content=[
    [12, -51.000003814697266, 3.999998092651367],
    [6, 167, -68],
    [-4, 24, -41.00000762939453],
  ])
}

test "panic qr/1d" {
  let a = @tensor.tensor([12.0, -51, 4])
  @linalg.qr(a) |> ignore
}

test "panic qr/3d" {
  let a = @tensor.tensor([
    [[12.0, -51, 4], [6, 167, -68], [-4, 24, -41]],
    [[12.0, -51, 4], [6, 167, -68], [-4, 24, -41]],
  ])
  @linalg.qr(a) |> ignore
}
