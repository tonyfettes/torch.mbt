struct Data {
  sepal_length : Double
  sepal_width : Double
  petal_length : Double
  petal_width : Double
  species : Species
} derive(Show)

enum Species {
  Setosa
  Versicolor
  Virginica
} derive(Show)

let dataset : Array[Data] = [
  {
    sepal_length: 5.1,
    sepal_width: 3.5,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.9,
    sepal_width: 3.0,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.7,
    sepal_width: 3.2,
    petal_length: 1.3,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.6,
    sepal_width: 3.1,
    petal_length: 1.5,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.6,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.4,
    sepal_width: 3.9,
    petal_length: 1.7,
    petal_width: 0.4,
    species: Setosa,
  },
  {
    sepal_length: 4.6,
    sepal_width: 3.4,
    petal_length: 1.4,
    petal_width: 0.3,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.4,
    petal_length: 1.5,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.4,
    sepal_width: 2.9,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.9,
    sepal_width: 3.1,
    petal_length: 1.5,
    petal_width: 0.1,
    species: Setosa,
  },
  {
    sepal_length: 5.4,
    sepal_width: 3.7,
    petal_length: 1.5,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.8,
    sepal_width: 3.4,
    petal_length: 1.6,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.8,
    sepal_width: 3.0,
    petal_length: 1.4,
    petal_width: 0.1,
    species: Setosa,
  },
  {
    sepal_length: 4.3,
    sepal_width: 3.0,
    petal_length: 1.1,
    petal_width: 0.1,
    species: Setosa,
  },
  {
    sepal_length: 5.8,
    sepal_width: 4.0,
    petal_length: 1.2,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.7,
    sepal_width: 4.4,
    petal_length: 1.5,
    petal_width: 0.4,
    species: Setosa,
  },
  {
    sepal_length: 5.4,
    sepal_width: 3.9,
    petal_length: 1.3,
    petal_width: 0.4,
    species: Setosa,
  },
  {
    sepal_length: 5.1,
    sepal_width: 3.5,
    petal_length: 1.4,
    petal_width: 0.3,
    species: Setosa,
  },
  {
    sepal_length: 5.7,
    sepal_width: 3.8,
    petal_length: 1.7,
    petal_width: 0.3,
    species: Setosa,
  },
  {
    sepal_length: 5.1,
    sepal_width: 3.8,
    petal_length: 1.5,
    petal_width: 0.3,
    species: Setosa,
  },
  {
    sepal_length: 5.4,
    sepal_width: 3.4,
    petal_length: 1.7,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.1,
    sepal_width: 3.7,
    petal_length: 1.5,
    petal_width: 0.4,
    species: Setosa,
  },
  {
    sepal_length: 4.6,
    sepal_width: 3.6,
    petal_length: 1.0,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.1,
    sepal_width: 3.3,
    petal_length: 1.7,
    petal_width: 0.5,
    species: Setosa,
  },
  {
    sepal_length: 4.8,
    sepal_width: 3.4,
    petal_length: 1.9,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.0,
    petal_length: 1.6,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.4,
    petal_length: 1.6,
    petal_width: 0.4,
    species: Setosa,
  },
  {
    sepal_length: 5.2,
    sepal_width: 3.5,
    petal_length: 1.5,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.2,
    sepal_width: 3.4,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.7,
    sepal_width: 3.2,
    petal_length: 1.6,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.8,
    sepal_width: 3.1,
    petal_length: 1.6,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.4,
    sepal_width: 3.4,
    petal_length: 1.5,
    petal_width: 0.4,
    species: Setosa,
  },
  {
    sepal_length: 5.2,
    sepal_width: 4.1,
    petal_length: 1.5,
    petal_width: 0.1,
    species: Setosa,
  },
  {
    sepal_length: 5.5,
    sepal_width: 4.2,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.9,
    sepal_width: 3.1,
    petal_length: 1.5,
    petal_width: 0.1,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.2,
    petal_length: 1.2,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.5,
    sepal_width: 3.5,
    petal_length: 1.3,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.9,
    sepal_width: 3.1,
    petal_length: 1.5,
    petal_width: 0.1,
    species: Setosa,
  },
  {
    sepal_length: 4.4,
    sepal_width: 3.0,
    petal_length: 1.3,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.1,
    sepal_width: 3.4,
    petal_length: 1.5,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.5,
    petal_length: 1.3,
    petal_width: 0.3,
    species: Setosa,
  },
  {
    sepal_length: 4.5,
    sepal_width: 2.3,
    petal_length: 1.3,
    petal_width: 0.3,
    species: Setosa,
  },
  {
    sepal_length: 4.4,
    sepal_width: 3.2,
    petal_length: 1.3,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.5,
    petal_length: 1.6,
    petal_width: 0.6,
    species: Setosa,
  },
  {
    sepal_length: 5.1,
    sepal_width: 3.8,
    petal_length: 1.9,
    petal_width: 0.4,
    species: Setosa,
  },
  {
    sepal_length: 4.8,
    sepal_width: 3.0,
    petal_length: 1.4,
    petal_width: 0.3,
    species: Setosa,
  },
  {
    sepal_length: 5.1,
    sepal_width: 3.8,
    petal_length: 1.6,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 4.6,
    sepal_width: 3.2,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.3,
    sepal_width: 3.7,
    petal_length: 1.5,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 5.0,
    sepal_width: 3.3,
    petal_length: 1.4,
    petal_width: 0.2,
    species: Setosa,
  },
  {
    sepal_length: 7.0,
    sepal_width: 3.2,
    petal_length: 4.7,
    petal_width: 1.4,
    species: Versicolor,
  },
  {
    sepal_length: 6.4,
    sepal_width: 3.2,
    petal_length: 4.5,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 6.9,
    sepal_width: 3.1,
    petal_length: 4.9,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 5.5,
    sepal_width: 2.3,
    petal_length: 4.0,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 6.5,
    sepal_width: 2.8,
    petal_length: 4.6,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 5.7,
    sepal_width: 2.8,
    petal_length: 4.5,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 6.3,
    sepal_width: 3.3,
    petal_length: 4.7,
    petal_width: 1.6,
    species: Versicolor,
  },
  {
    sepal_length: 4.9,
    sepal_width: 2.4,
    petal_length: 3.3,
    petal_width: 1.0,
    species: Versicolor,
  },
  {
    sepal_length: 6.6,
    sepal_width: 2.9,
    petal_length: 4.6,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 5.2,
    sepal_width: 2.7,
    petal_length: 3.9,
    petal_width: 1.4,
    species: Versicolor,
  },
  {
    sepal_length: 5.0,
    sepal_width: 2.0,
    petal_length: 3.5,
    petal_width: 1.0,
    species: Versicolor,
  },
  {
    sepal_length: 5.9,
    sepal_width: 3.0,
    petal_length: 4.2,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 6.0,
    sepal_width: 2.2,
    petal_length: 4.0,
    petal_width: 1.0,
    species: Versicolor,
  },
  {
    sepal_length: 6.1,
    sepal_width: 2.9,
    petal_length: 4.7,
    petal_width: 1.4,
    species: Versicolor,
  },
  {
    sepal_length: 5.6,
    sepal_width: 2.9,
    petal_length: 3.6,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 6.7,
    sepal_width: 3.1,
    petal_length: 4.4,
    petal_width: 1.4,
    species: Versicolor,
  },
  {
    sepal_length: 5.6,
    sepal_width: 3.0,
    petal_length: 4.5,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 5.8,
    sepal_width: 2.7,
    petal_length: 4.1,
    petal_width: 1.0,
    species: Versicolor,
  },
  {
    sepal_length: 6.2,
    sepal_width: 2.2,
    petal_length: 4.5,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 5.6,
    sepal_width: 2.5,
    petal_length: 3.9,
    petal_width: 1.1,
    species: Versicolor,
  },
  {
    sepal_length: 5.9,
    sepal_width: 3.2,
    petal_length: 4.8,
    petal_width: 1.8,
    species: Versicolor,
  },
  {
    sepal_length: 6.1,
    sepal_width: 2.8,
    petal_length: 4.0,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 6.3,
    sepal_width: 2.5,
    petal_length: 4.9,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 6.1,
    sepal_width: 2.8,
    petal_length: 4.7,
    petal_width: 1.2,
    species: Versicolor,
  },
  {
    sepal_length: 6.4,
    sepal_width: 2.9,
    petal_length: 4.3,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 6.6,
    sepal_width: 3.0,
    petal_length: 4.4,
    petal_width: 1.4,
    species: Versicolor,
  },
  {
    sepal_length: 6.8,
    sepal_width: 2.8,
    petal_length: 4.8,
    petal_width: 1.4,
    species: Versicolor,
  },
  {
    sepal_length: 6.7,
    sepal_width: 3.0,
    petal_length: 5.0,
    petal_width: 1.7,
    species: Versicolor,
  },
  {
    sepal_length: 6.0,
    sepal_width: 2.9,
    petal_length: 4.5,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 5.7,
    sepal_width: 2.6,
    petal_length: 3.5,
    petal_width: 1.0,
    species: Versicolor,
  },
  {
    sepal_length: 5.5,
    sepal_width: 2.4,
    petal_length: 3.8,
    petal_width: 1.1,
    species: Versicolor,
  },
  {
    sepal_length: 5.5,
    sepal_width: 2.4,
    petal_length: 3.7,
    petal_width: 1.0,
    species: Versicolor,
  },
  {
    sepal_length: 5.8,
    sepal_width: 2.7,
    petal_length: 3.9,
    petal_width: 1.2,
    species: Versicolor,
  },
  {
    sepal_length: 6.0,
    sepal_width: 2.7,
    petal_length: 5.1,
    petal_width: 1.6,
    species: Versicolor,
  },
  {
    sepal_length: 5.4,
    sepal_width: 3.0,
    petal_length: 4.5,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 6.0,
    sepal_width: 3.4,
    petal_length: 4.5,
    petal_width: 1.6,
    species: Versicolor,
  },
  {
    sepal_length: 6.7,
    sepal_width: 3.1,
    petal_length: 4.7,
    petal_width: 1.5,
    species: Versicolor,
  },
  {
    sepal_length: 6.3,
    sepal_width: 2.3,
    petal_length: 4.4,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 5.6,
    sepal_width: 3.0,
    petal_length: 4.1,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 5.5,
    sepal_width: 2.5,
    petal_length: 4.0,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 5.5,
    sepal_width: 2.6,
    petal_length: 4.4,
    petal_width: 1.2,
    species: Versicolor,
  },
  {
    sepal_length: 6.1,
    sepal_width: 3.0,
    petal_length: 4.6,
    petal_width: 1.4,
    species: Versicolor,
  },
  {
    sepal_length: 5.8,
    sepal_width: 2.6,
    petal_length: 4.0,
    petal_width: 1.2,
    species: Versicolor,
  },
  {
    sepal_length: 5.0,
    sepal_width: 2.3,
    petal_length: 3.3,
    petal_width: 1.0,
    species: Versicolor,
  },
  {
    sepal_length: 5.6,
    sepal_width: 2.7,
    petal_length: 4.2,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 5.7,
    sepal_width: 3.0,
    petal_length: 4.2,
    petal_width: 1.2,
    species: Versicolor,
  },
  {
    sepal_length: 5.7,
    sepal_width: 2.9,
    petal_length: 4.2,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 6.2,
    sepal_width: 2.9,
    petal_length: 4.3,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 5.1,
    sepal_width: 2.5,
    petal_length: 3.0,
    petal_width: 1.1,
    species: Versicolor,
  },
  {
    sepal_length: 5.7,
    sepal_width: 2.8,
    petal_length: 4.1,
    petal_width: 1.3,
    species: Versicolor,
  },
  {
    sepal_length: 6.3,
    sepal_width: 3.3,
    petal_length: 6.0,
    petal_width: 2.5,
    species: Virginica,
  },
  {
    sepal_length: 5.8,
    sepal_width: 2.7,
    petal_length: 5.1,
    petal_width: 1.9,
    species: Virginica,
  },
  {
    sepal_length: 7.1,
    sepal_width: 3.0,
    petal_length: 5.9,
    petal_width: 2.1,
    species: Virginica,
  },
  {
    sepal_length: 6.3,
    sepal_width: 2.9,
    petal_length: 5.6,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.5,
    sepal_width: 3.0,
    petal_length: 5.8,
    petal_width: 2.2,
    species: Virginica,
  },
  {
    sepal_length: 7.6,
    sepal_width: 3.0,
    petal_length: 6.6,
    petal_width: 2.1,
    species: Virginica,
  },
  {
    sepal_length: 4.9,
    sepal_width: 2.5,
    petal_length: 4.5,
    petal_width: 1.7,
    species: Virginica,
  },
  {
    sepal_length: 7.3,
    sepal_width: 2.9,
    petal_length: 6.3,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.7,
    sepal_width: 2.5,
    petal_length: 5.8,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 7.2,
    sepal_width: 3.6,
    petal_length: 6.1,
    petal_width: 2.5,
    species: Virginica,
  },
  {
    sepal_length: 6.5,
    sepal_width: 3.2,
    petal_length: 5.1,
    petal_width: 2.0,
    species: Virginica,
  },
  {
    sepal_length: 6.4,
    sepal_width: 2.7,
    petal_length: 5.3,
    petal_width: 1.9,
    species: Virginica,
  },
  {
    sepal_length: 6.8,
    sepal_width: 3.0,
    petal_length: 5.5,
    petal_width: 2.1,
    species: Virginica,
  },
  {
    sepal_length: 5.7,
    sepal_width: 2.5,
    petal_length: 5.0,
    petal_width: 2.0,
    species: Virginica,
  },
  {
    sepal_length: 5.8,
    sepal_width: 2.8,
    petal_length: 5.1,
    petal_width: 2.4,
    species: Virginica,
  },
  {
    sepal_length: 6.4,
    sepal_width: 3.2,
    petal_length: 5.3,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 6.5,
    sepal_width: 3.0,
    petal_length: 5.5,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 7.7,
    sepal_width: 3.8,
    petal_length: 6.7,
    petal_width: 2.2,
    species: Virginica,
  },
  {
    sepal_length: 7.7,
    sepal_width: 2.6,
    petal_length: 6.9,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 6.0,
    sepal_width: 2.2,
    petal_length: 5.0,
    petal_width: 1.5,
    species: Virginica,
  },
  {
    sepal_length: 6.9,
    sepal_width: 3.2,
    petal_length: 5.7,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 5.6,
    sepal_width: 2.8,
    petal_length: 4.9,
    petal_width: 2.0,
    species: Virginica,
  },
  {
    sepal_length: 7.7,
    sepal_width: 2.8,
    petal_length: 6.7,
    petal_width: 2.0,
    species: Virginica,
  },
  {
    sepal_length: 6.3,
    sepal_width: 2.7,
    petal_length: 4.9,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.7,
    sepal_width: 3.3,
    petal_length: 5.7,
    petal_width: 2.1,
    species: Virginica,
  },
  {
    sepal_length: 7.2,
    sepal_width: 3.2,
    petal_length: 6.0,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.2,
    sepal_width: 2.8,
    petal_length: 4.8,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.1,
    sepal_width: 3.0,
    petal_length: 4.9,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.4,
    sepal_width: 2.8,
    petal_length: 5.6,
    petal_width: 2.1,
    species: Virginica,
  },
  {
    sepal_length: 7.2,
    sepal_width: 3.0,
    petal_length: 5.8,
    petal_width: 1.6,
    species: Virginica,
  },
  {
    sepal_length: 7.4,
    sepal_width: 2.8,
    petal_length: 6.1,
    petal_width: 1.9,
    species: Virginica,
  },
  {
    sepal_length: 7.9,
    sepal_width: 3.8,
    petal_length: 6.4,
    petal_width: 2.0,
    species: Virginica,
  },
  {
    sepal_length: 6.4,
    sepal_width: 2.8,
    petal_length: 5.6,
    petal_width: 2.2,
    species: Virginica,
  },
  {
    sepal_length: 6.3,
    sepal_width: 2.8,
    petal_length: 5.1,
    petal_width: 1.5,
    species: Virginica,
  },
  {
    sepal_length: 6.1,
    sepal_width: 2.6,
    petal_length: 5.6,
    petal_width: 1.4,
    species: Virginica,
  },
  {
    sepal_length: 7.7,
    sepal_width: 3.0,
    petal_length: 6.1,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 6.3,
    sepal_width: 3.4,
    petal_length: 5.6,
    petal_width: 2.4,
    species: Virginica,
  },
  {
    sepal_length: 6.4,
    sepal_width: 3.1,
    petal_length: 5.5,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.0,
    sepal_width: 3.0,
    petal_length: 4.8,
    petal_width: 1.8,
    species: Virginica,
  },
  {
    sepal_length: 6.9,
    sepal_width: 3.1,
    petal_length: 5.4,
    petal_width: 2.1,
    species: Virginica,
  },
  {
    sepal_length: 6.7,
    sepal_width: 3.1,
    petal_length: 5.6,
    petal_width: 2.4,
    species: Virginica,
  },
  {
    sepal_length: 6.9,
    sepal_width: 3.1,
    petal_length: 5.1,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 5.8,
    sepal_width: 2.7,
    petal_length: 5.1,
    petal_width: 1.9,
    species: Virginica,
  },
  {
    sepal_length: 6.8,
    sepal_width: 3.2,
    petal_length: 5.9,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 6.7,
    sepal_width: 3.3,
    petal_length: 5.7,
    petal_width: 2.5,
    species: Virginica,
  },
  {
    sepal_length: 6.7,
    sepal_width: 3.0,
    petal_length: 5.2,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 6.3,
    sepal_width: 2.5,
    petal_length: 5.0,
    petal_width: 1.9,
    species: Virginica,
  },
  {
    sepal_length: 6.5,
    sepal_width: 3.0,
    petal_length: 5.2,
    petal_width: 2.0,
    species: Virginica,
  },
  {
    sepal_length: 6.2,
    sepal_width: 3.4,
    petal_length: 5.4,
    petal_width: 2.3,
    species: Virginica,
  },
  {
    sepal_length: 5.9,
    sepal_width: 3.0,
    petal_length: 5.1,
    petal_width: 1.8,
    species: Virginica,
  },
]

test {
  let rand = @random.Rand::new()
  let model = [
      @torch.Linear::new(4, 4),
      @torch.ReLU::new(),
      @torch.Linear::new(4, 5),
      @torch.ReLU::new(),
      @torch.Linear::new(5, 3),
      @torch.Softmax::new(),
    ]
    |> @torch.Sequential::new
  let dataset = dataset.shuffle(rand=fn(upper) { rand.int(limit=upper) })
  let split = (dataset.length().to_double() * 0.8).floor().to_int()
  let train = dataset[:split]
  let validate = dataset[split:]
  let loss = @torch.CrossEntropyLoss::new()
  let total_epoch = 128
  let total_step = total_epoch * train.length()
  let mut step = 0
  for epoch = 0; epoch < total_epoch; epoch = epoch + 1 {
    for datum in train {
      let input = [
        datum.sepal_length,
        datum.sepal_width,
        datum.petal_length,
        datum.petal_width,
      ]
      let target = match datum.species {
        Setosa => [1.0, 0.0, 0.0]
        Versicolor => [0.0, 1.0, 0.0]
        Virginica => [0.0, 0.0, 1.0]
      }
      let output = model.forward(@torch.Tensor::val(input))
      let lr = 0.01 *
        (@math.cos(step.to_double() / total_step.to_double() * @math.pi) + 1.0)
      loss.forward(output, @torch.Tensor::val(target)).backward(lr)
      step = step + 1
    }
  }
  let mut accuracy = 0.0
  for datum in validate {
    let input = [
      datum.sepal_length,
      datum.sepal_width,
      datum.petal_length,
      datum.petal_width,
    ]
    let target = match datum.species {
      Setosa => [1.0, 0.0, 0.0]
      Versicolor => [0.0, 1.0, 0.0]
      Virginica => [0.0, 0.0, 1.0]
    }
    let output = model.forward(@torch.Tensor::val(input))
    accuracy += output.dot(@torch.Tensor::val(target)).value
  }
  inspect!(
    accuracy / validate.length().to_double(),
    content="0.951233288139901",
  )
}
